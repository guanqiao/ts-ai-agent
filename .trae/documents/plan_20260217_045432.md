## 增量更新优化方案

基于代码分析，我将实施以下优化：

### 第一阶段：快速见效优化

#### 1. 快照索引优化
**文件**: `src/sync/incremental-updater.ts`
- 新增 `SnapshotIndex` 类管理快照索引
- 维护 `latest-snapshot.json` 索引文件
- 快照查找从 O(n) 降到 O(1)

#### 2. 多级缓存机制
**新文件**: `src/wiki/incremental/hash-cache.ts`
- 实现 `HashCacheManager` 缓存文件 hash
- 基于文件修改时间的快速校验
- 减少重复 hash 计算

#### 3. 动态阈值调整
**文件**: `src/wiki/wiki-manager.ts`
- 根据项目规模自动调整增量更新阈值
- 小项目(<50文件): 30%, 中项目(<200文件): 50%, 大项目: 70%
- 记录历史变更模式进行自适应调整

### 第二阶段：核心优化

#### 4. 符号级别变更追踪
**新文件**: `src/wiki/incremental/symbol-tracker.ts`
- 实现 `SymbolSnapshot` 存储符号级别信息
- 构建符号依赖图
- 精确定位需要更新的内容

#### 5. 增量内容生成
**文件**: `src/wiki/wiki-manager.ts`
- 只生成变更相关的内容部分
- 避免未受影响页面的重新生成
- 按需生成符号文档

#### 6. 智能变更影响分析
**新文件**: `src/wiki/incremental/impact-analyzer.ts`
- 构建文件-符号-页面三级关联图
- 追踪直接和间接影响
- 支持优先级排序

### 第三阶段：质量提升

#### 7. 智能合并改进
**文件**: `src/wiki/incremental/page-updater.ts`
- 实现基于 Myers diff 的内容差异算法
- 支持用户编辑标记保留
- 添加冲突检测机制

#### 8. 并行化处理
**文件**: `src/wiki/incremental/parallel-updater.ts`
- 按依赖关系分组页面
- 独立页面并行更新
- 可配置并行度

### 预期收益

| 优化项 | 性能提升 |
|--------|---------|
| 快照索引 | 查找速度 O(n)→O(1) |
| Hash缓存 | 减少60-80%计算 |
| 动态阈值 | 提高增量命中率 |
| 符号追踪 | 减少40-60%不必要更新 |
| 增量生成 | 减少50-70%生成时间 |
| 并行处理 | 减少30-50%总时间 |