## WikiKnowledgeBase 单元测试计划

### 目标
为 `src/wiki/wiki-knowledge-base.ts` 新增单元测试，覆盖率达到 80% 以上

### 测试文件
创建 `tests/wiki/wiki-knowledge-base.test.ts`

### 测试用例设计

#### 1. 构造函数测试
- 无参数构造（llmService 为 null）
- 带 LLMService 参数构造

#### 2. index 方法测试
- 索引单个页面
- 索引多个页面
- 重复索引应清空旧数据

#### 3. query 方法测试
- 空索引时返回无结果消息
- 无 LLM 时使用关键词匹配
- 有 LLM 时调用 LLM 服务
- LLM 异常时回退到关键词匹配

#### 4. search 方法测试
- 关键词匹配标题
- 关键词匹配内容
- 关键词匹配标签
- section 内容匹配
- 结果按分数排序
- 结果限制为 10 条

#### 5. getRelatedPages 方法测试
- 页面无链接时返回空数组
- 通过 markdown 链接关联
- 通过 links 数组关联内部链接
- 忽略外部链接

#### 6. getContext 方法测试
- 无匹配页面时返回空字符串
- 有匹配页面时返回上下文
- 最多返回 3 个页面的上下文

#### 7. setLLMService 方法测试
- 动态设置 LLM 服务

#### 8. 私有方法边界测试（通过公开方法间接测试）
- `buildSearchIndex`: 处理带 section 的内容、处理标签
- `extractLinks`: 提取 markdown 链接、提取内部链接
- `findRelevantPages`: 评分逻辑、结果排序
- `queryWithKeywordMatch`: 生成答案
- `extractSummary`: 截取摘要

### Mock 策略
- Mock LLMService 的 `complete` 方法
- Mock LLMService 抛出异常的情况